<div class="container my-5">
  <div class="row">
    <!-- プロフィールセクション -->
    <div class="col-lg-4 mb-4">
      <div class="card shadow-sm">
        <div class="card-body">
          <div class="text-center mb-4">
            <%= image_tag @user.avatar.attached? ? url_for(@user.avatar) : "https://mdbcdn.b-cdn.net/img/new/avatars/2.webp", class: "profile-avatar" %>
          </div>
          <h4 class="card-title text-center mb-3"><%= @user.username %></h4>
          <ul class="list-group list-group-flush">
            <li class="list-group-item"><i class="bi bi-envelope-fill me-2"></i><%= @user.email %></li>
            <% if Rails.env.development? %>
              <li class="list-group-item"><i class="bi bi-person-badge-fill me-2"></i><%= @user.role %></li>
            <% end %>
          </ul>

          <% if @user.rolable_type == 'Applicant' %>
            <div class="mt-4">
              <% if @user.rolable.birthday.present? %>
                <div class="d-flex align-items-center mb-2">
                  <i class="bi bi-calendar me-2"></i>
                  <span>生年月日: <%= @user.rolable.birthday %></span>
                </div>
              <% end %>
              
              <% if @user.rolable.age.present? %>
                <div class="d-flex align-items-center mb-2">
                  <i class="bi bi-person me-2"></i>
                  <span>年齢: <%= @user.rolable.age %></span>
                </div>
              <% end %>
              
              <% if @user.rolable.nationality.present? %>
                <div class="d-flex align-items-center mb-2">
                  <i class="bi bi-globe me-2"></i>
                  <span>国籍: <%= @user.rolable.nationality %></span>
                </div>
              <% end %>
              
              <% if @user.rolable.phone_number.present? %>
                <div class="d-flex align-items-center mb-2">
                  <i class="bi bi-telephone me-2"></i>
                  <span>電話番号: <%= @user.rolable.phone_number %></span>
                </div>
              <% end %>
              
              <% if @user.rolable.desired_salary.present? %>
                <div class="d-flex align-items-center mb-2">
                  <i class="bi bi-currency-dollar me-2"></i>
                  <span>希望給与: <%= @user.rolable.desired_salary %></span>
                </div>
              <% end %>
            </div>


            <% if @user.rolable.self_introduction.present? %>
              <div class="mt-4">
                <h5 class="card-title">自己紹介</h5>
                <p class="card-text"><%= @user.rolable.self_introduction %></p>
              </div>
            <% end %>
          <% end %>
        </div>
      </div>
    </div>

    <!-- 経歴書アップロードと表示セクション -->
    <div class="col-lg-8 mb-4">
      <div class="card shadow-sm">
        <div class="card-body">
          <h2 class="card-title text-center mb-4">AI に添削を依頼する</h2>
          <p class="text-center text-muted mb-4">履歴書・職務経歴書をアップロードして、誤字脱字や日本語の不備を確認します</p>
          
          <%= form_with model: @user, url: user_path(@user), local: true, multipart: true, class: "mb-4" do |form| %>
            <div class="mb-3">
              <div class="d-flex justify-content-center mb-3">
                <%= form.file_field :resume, class: "form-control", accept: "application/pdf,image/*", style: "max-width: 50%;" %>
              </div>
            </div>
            <div class="text-center">
              <%= form.submit "アップロード", class: "btn btn-primary" %>
            </div>
          <% end %>

          <% if @user.rolable&.resume.attached? %>
            <div class="mt-4">
              <h5 class="card-title">アップロードされたファイル</h5>
              <% if @user.resume.content_type.start_with?('image/') %>
                <%= image_tag url_for(@user.resume), class: "img-fluid rounded" %>
              <% elsif @user.resume.content_type == 'application/pdf' %>
                <div class="ratio ratio-16x9">
                  <%= tag.iframe src: url_for(@user.resume), class: "rounded" %>
                </div>
              <% else %>
                <p>このファイルは表示できません。<%= link_to 'こちらからダウンロード', url_for(@user.resume), class: "btn btn-sm btn-outline-primary" %>してください。</p>
              <% end %>
            </div>
          <% end %>
        </div>
      </div>
    </div>
  </div>

  <!-- 改善点の提案セクション -->
  <% if @improvement_suggestions %>
    <div class="row mt-4">
      <div class="col-12">
        <div class="card shadow-sm">
          <div class="card-body">
            <h3 class="card-title mb-3">改善点の提案</h3>
            <div class="bg-light border rounded p-3">
              <%= simple_format(@improvement_suggestions) %>
            </div>
          </div>
        </div>
      </div>
    </div>
  <% end %>
</div>

<% content_for :head do %>
  <style>
    .profile-avatar {
      width: 150px;
      height: 150px;
      border-radius: 50%;
      object-fit: cover;
      border: 5px solid #f8f9fa;
    }
    .btn-primary {
      background-color: #4285F4;
      border-color: #4285F4;
    }
    .btn-primary:hover {
      background-color: #357ae8;
      border-color: #357ae8;
    }
  </style>
<% end %>